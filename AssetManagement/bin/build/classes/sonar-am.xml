<?xml version="1.0" encoding="UTF-8"?>
<project name="${project.name}" default="sonar-am" basedir="..">

	<!-- import the properties file -->
	<property file="conf/build.properties"/>

	<!-- libs for the project -->
	<path id="lib_classpath">
		<fileset dir="${project.lib}">
			<include name="*.jar"/>
		</fileset>
	</path>

	<!-- libs in the tomcat -->
	<path id="lib_tomcat">
		<fileset dir="${tomcat.lib}">
			<include name="*.jar"/>
		</fileset>
	</path>
	<!-- sonar -->
	<!-- Define information about database -->
	<property name="sonar.jdbc.url" value="jdbc:mysql://localhost:3306/sonar?useUnicode=true&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=true"/>
	<property name="sonar.jdbc.driverClassName" value="com.mysql.jdbc.Driver" />
	<property name="sonar.jdbc.username" value="${jdbc.username}" />
	<property name="sonar.jdbc.password" value="${jdbc.password}" />
	<!-- Specify the host -->
	<property name="sonar.host.url" value="http://127.0.0.1:8888/sonar" />
	<!-- Declare the task defined by sonar -->
	<taskdef uri="antlib:org.sonar.ant" resource="org/sonar/ant/antlib.xml">
			<classpath>
                <pathelement location="C:/PMSProject/programs/cobertura/lib/sonar-ant-task-1.4.jar" />
            </classpath>
	</taskdef>
	<!--  Define the main properties of the project -->
	<property name="webinf.classes" value="${project.lib}" />
	<property name="sonar.projectKey" value="my:${project.name}" />
	<property name="sonar.projectName" value="${project.name}" />
	<property name="sonar.sources" value="${project.src}" />
	<property name="sonar.binaries" value="${project.sonar}" />
	<!--  The following properties are required to use JaCoCo: -->
	<!--  1. Tells Sonar to run the unit tests -->
	<property name="sonar.dynamicAnalysis" value="reuseReports" />
	<property name="sonar.surefire.reportsPath" value="junit-report" />
	<!--  2. Tells Sonar which "tests" targets to run -->
	<property name="sonar.cobertura.reportPath" value="cobertura-reports/cobertura-coverage-xml/coverage.xml" />

	<!-- compile the source codes (exclude the codes for test) -->
	<target name="compile.src" description="compile the source codes (exclude the codes for test)">
		<javac encoding = "utf-8" srcdir="${project.src}" destdir="${project.sonar}" debug="yes">
			<classpath refid="lib_classpath"/>
			<classpath refid="lib_tomcat"/>
		</javac>
		<echo>successfullly compiled source codes (exclude the codes for test) from ${project.src} to ${project.bin}</echo>
	</target>

	<!-- Run sonar to do code checking -->
	<target name="sonar-am" depends="compile.src" description="Run sonar to do code checking">
		<echo message="Checking the coding style of ${project.name}!"/>
		<sonar:sonar key="${sonar.projectKey}" version="1.0" xmlns:sonar="antlib:org.sonar.ant" />
		<echo message="Finished the code checking!"/>
	</target>

</project>